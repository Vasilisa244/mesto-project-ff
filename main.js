(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-4",headers:{authorization:"2805580d-35e3-4b90-8bbe-1cc5c46791e0","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))},r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))},o=document.querySelector("#card-template").content;function c(e,t,n,r,c){var a=o.querySelector(".places__item").cloneNode(!0),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__like-button"),s=a.querySelector(".card__image"),l=a.querySelector(".card__title"),d=a.querySelector(".card__likes");return l.textContent=e.name,s.src=e.link,s.alt=e.name,d.textContent=e.likes.length,function(e,t,n){return e!==n&&t.classList.add("card__delete-button-disabled"),!0}(e.owner._id,u,t)&&u.addEventListener("click",(function(t){n(t,e._id)})),e.likes.some((function(e){return e._id===t}))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(function(t){r(t,e._id,d)})),s.addEventListener("click",c),a}function a(n,r){(function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))})(r).then((function(){return n.target.closest(".card").remove()}))}function u(e,t,o){(e.target.classList.contains("card__like-button_is-active")?r:n)(t).then((function(t){e.target.classList.toggle("card__like-button_is-active"),o.textContent=t.likes.length})).catch((function(e){return console.log(e)}))}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d),document.addEventListener("click",l)}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d),document.removeEventListener("click",l)}function l(e){e.target.classList.contains("popup_is-opened")&&s(document.querySelector(".popup_is-opened"))}function d(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}function p(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){f(t,e,n),_(t,e,n)})),v(t,n,r)}function f(e,t,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?_(e,t,n):m(e,t,n,n.validationMessage)}var m=function(e,t,n,r){var o=t.querySelector(".".concat(n.id,"-error"));n.classList.add(e.inputErrorClass),o.textContent=r,o.classList.add(e.errorClass)},_=function(e,t,n){var r=t.querySelector(".".concat(n.id,"-error"));n.classList.remove(e.inputErrorClass),r.classList.remove(e.errorClass),r.textContent=""};function v(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.removeAttribute("disabled",!1),n.classList.remove(e.inactiveButtonClass)):(n.setAttribute("disabled",!0),n.classList.add(e.inactiveButtonClass))}for(var y,h=document.querySelector(".places__list"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__edit-button"),q=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup__caption"),L=document.querySelector('form[name="edit-profile"]'),k=L.querySelector(".popup__button"),C=L.querySelector('input[name="name"]'),g=L.querySelector('input[name="description"]'),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__title"),U=document.querySelector(".popup_type_new-card"),T=document.querySelector('form[name="new-place"]'),w=T.querySelector(".popup__button"),B=T.querySelector('input[name="place-name"]'),D=T.querySelector('input[name="link"]'),P=document.querySelector(".popup__image"),N=document.querySelector(".popup_type_image"),O=document.querySelectorAll(".popup__close"),j=document.querySelectorAll(".popup__button"),J=document.querySelector(".profile__image"),M=document.querySelector(".popup_avatar"),H=document.querySelector('form[name="edit-avatar"]'),V=H.querySelector(".popup__button"),z=H.querySelector('input[name="avatar-link"]'),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error"},F=0;F<j.length;F++)j[F].addEventListener("click",(function(){"Сохранить"===this.textContent&&(this.textContent="Сохранение...")}));Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return t(e)}))]).then((function(e){var t=e[0];y=t._id;var n=e[1];G(t),function(e,t){e.forEach((function(e){h.append(c(e,t,a,u,K))}))}(n,y)})).catch((function(e){console.log(e)}));var G=function(e){A.textContent=e.name,x.textContent=e.about,J.style.backgroundImage="url(".concat(e.avatar,")")};function K(e){var t=e.target.closest(".places__item"),n=t.querySelector(".card__image");P.src=n.src,P.alt=n.alt,E.textContent=t.innerText,i(N)}b.addEventListener("click",(function(){i(q),C.value=A.textContent,g.value=x.textContent,k.textContent="Сохранить",p(L,I)})),S.addEventListener("click",(function(){i(U),w.textContent="Сохранить",p(T,I)})),J.addEventListener("click",(function(){i(M),V.textContent="Сохранить",p(H,I)})),O.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return s(t)}))})),L.addEventListener("submit",(function(n){var r;n.preventDefault(),(r={name:C.value,about:g.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r.name,about:r.about})}).then((function(e){return t(e)}))).then((function(e){G(e),s(q)})).catch((function(e){console.log(e)}))})),H.addEventListener("submit",(function(n){var r;n.preventDefault(),(r=z,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r.value})}).then((function(e){return t(e)}))).then((function(e){G(e),s(M)})).catch((function(e){console.log(e)}))})),T.addEventListener("submit",(function(n){var r;n.preventDefault(),(r={name:B.value,link:D.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:r.name,link:r.link})}).then((function(e){return t(e)}))).then((function(e){var t=c(e,y,a,u,K);h.prepend(t),B.value="",D.value="",s(U)})).catch((function(e){console.log(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);v(e,n,r),n.forEach((function(o){o.addEventListener("input",(function(){f(e,t,o),v(e,n,r)}))}))}(e,t)}))}(I)})();